# Section38: 하나로 묶기: Express와 Mongoose

간단한 웹 앱을 만든다. 새 모델을 생성하고 Express를 통해 삭제된 것, 업데이트된 것, 완전한 CRUD를 인스턴스화 한다.  
사용자 인터페이스가 있고 웹 서핑이 있겠지만 그 이면에서는 Mongoose를 사용해서 업데이트 및 Mongo데이터베이스와 상호작용을 한다.  
이 섹션에선 농장 판매대 애플리케이션을 만든다.

## Express와 Mongoose 기본 설정

필요한 폴더와 파일들을 먼저 생성해준다. 그리고 필요한 라이브러리들을 설치한다.  
Express와 Mongoose를 이용해서 데이터베이스와 서버를 연결한다.

## 모델 만들기

product 모델을 하나 만든다. 과일이나 채소, 유제품 등에 몇몇 특성을 부여하고 조정한다.  
폴더를 분리해서 모델 디렉토리를 만들고 거기에 모델을 전부 넣을 것이다.  
데이터베이스에 초기에 넣어둘 seeds.js를 만들었다.

## 프로덕트 인덱스

MongoDB에 보낼 쿼리를 만드는 라우트를 정의한다.
views 폴더 안에 요청을 받으면 화면에 렌더링할 페이지를 만든다.

## 프로덕트 디테일

product의 id를 이용해서 상품 정보를 렌더링하는 라우터를 만든다.  
req.params에서 id를 구조분해 후 findById()를 이용해서 id를 찾는다.
products/:id로 검색하면 렌더링하는 show.ejs를 만든다.
앵커 태그로 index.ejs와 show.ejs를 이동할 수 있게 만든다.

## 프로덕트 만들기

새로운 상품을 추가하는 폼과 폼을 제출할 두 개의 라우트를 만든다.
새로운 상품을 등록하는 new.ejs 페이지를 만들고 get요청으로 라우트를 만들었다.  
new.ejs에서 정보를 입력하고 submit하면 데이터베이스에 저장시키는 라우트를 post요청으로 만들었다. post요청으로 만들어서 redirect()를 사용했다.

## 프로덕트 업데이트하기

edit.ejs 페이지를 만들고 id를 조회해서 상품 페이지를 불러오는 라우트를 get 요청으로 만든다.  
입력되어 있는 정보를 수정해서 요청을 보내야 하므로 Put 요청을 사용하는데 우리는 get과 post 요청밖에 사용할 수 없다. 그래서 put 요청을 사용할 수 있게 해주는 method-override 패키지를 설치해서 edit.ejs와 put요청 라우트에 사용한다.

## 카테고리 셀렉터 위의 탄젠트

편집용 폼의 Select Category에 설정된 값을 디폴트로 표시해서 값을 편집하지 않을 때도 일일이 수정할 필요가 없도록 만든다.  
option 태그에 일일이 작성하기는 번거로우니 옵션을 생성하는 루프를 index.js에 만들어 사용한다.

## 프로덕트 삭제하기

show.ejs에 Delete 버튼을 만들고 index.js에 delete요청으로 라우트를 만든다. method-override 패키지를 사용해서 delete요청을 post 요청으로 사용할 수 있게 했다.

## 카테고리별로 필터링하기

일반적으로 정보의 부분집합을 필터링하거나 검색할 때 쿼리 문자열을 사용한다.

- ex. /products?category=dairy

카테고리가 있으면 그 카테고리가 뭔지 나타내야 한다.

# Section46: YelpCamp: 리뷰 모델 추가하기

## 리뷰 모델 정의하기

평점이나 리뷰 같은 것이 들어가는 모델을 만든다. 숫자로 된 평점 뿐만 아니라 텍스트도 들어간다.
models 폴더에 review.js 모델을 만들어 준 후, campground.js 모델에 review 객체ID 배열을 만들어 준 후 ref를 사용해서 review.js 모델과 연결한다.

## 리뷰 형식 추가하기

views/capmgrounds/show.ejs 파일에 평점을 남길 수 있는 폼을 만든다.

## 리뷰 작성하기

리뷰 작성을 위해서는 이와 연결되는 캠핑장을 알아야 한다. 가장 쉬운 옵션은 경로에 캠핑장ID를 넣는 것이다.  
app.js에 /campgrounds/:id/review 경로로 post요청을 하는 라우터를 만들고 views/capmgrounds/show.ejs 파일에 form 에 /campgrounds/:id/review 경로를 추가해준다.

## 리뷰 검증하기

클라이언트 측 유효성 검사부터 시작해서 비어 있는 리뷰를 제출하지 못하도록 한다.
서버 측은 Joi 패키지를 사용해서 schemas.js에 작성한다.  
error가 발생하면 잡아주는 validateReview 함수를 작성해서 라우터에 적용시킨다.

## 리뷰 표시하기

우선 캠프장 모델에 populate() 를 사용해서 캠프장에 연결된 리뷰를 렌더링해야한다. app.js에 있는 캠프장 show 페이지의 라우트에 채워 넣는다.  
라우트의 내용을 전달했으면 템플릿 안에 모든 리뷰를 루프시킨다.

## 리뷰 스타일링

부트스트랩을 이용해 카드 클래스로 각각의 리뷰에 테두리를 만든다.

## 리뷰 삭제하기

리뷰를 삭제하는 버튼을 만들고 상황에 따라 숨길 수도 있다.  
우선 app.js에 delete 요청을 하는 라우트의 틀을 만든다.  
그 다음 show.ejs에 삭제하는 버튼을 만든다.  
작동하는 것을 확인하면 캠핑장 ID와 리뷰ID를 가져와서 업데이트한다.  
동작 순서는 캠핑장을 찾을 때까지 기다렸다가 리뷰 배열로부터 해당 리뷰의 참조를 삭제하고 그다음엔 해당 리뷰를 모두 삭제한다.

## 캠프그라운드의 미들웨어 삭제

캠핑장을 삭제했을 때 해당 캠핑장에 등록된 리뷰를 삭제하는 법을 살펴보자.
campground.js 모델에서 post 미들웨어를 사용해 문서가 있을 경우 그 문서에 \_id 객체 안의 모든 리뷰를 지우도록 한다.
